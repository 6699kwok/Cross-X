(function createCrossXI18n(global) {
  const dictionary = {
    ZH: {
      terms: {
        task: "任务",
        plan: "计划",
        lane: "路线",
        proof: "凭证",
      },
      ui: {
        language_name: "中文",
        tab_chat: "对话",
        tab_near: "附近",
        tab_trips: "订单",
        tab_me: "我的",
        tab_trust: "信任",
        send: "发送",
        execute: "确认并开始执行",
        emergency: "紧急求助",
        input_placeholder: "示例：帮我找附近地道餐厅并完成排队、支付和导航。",
        one_sentence: "一句话，一个完整闭环。",
        loading_plan: "正在生成计划...",
        close: "关闭",
        cancel: "取消",
        confirm: "确认",
        open_trust_advanced: "打开高级信任设置",
        lane_tradeoffs: "路线权衡",
        lane_show_details: "展开权衡",
        lane_hide_details: "收起权衡",
        run_lane: "试跑此路线",
        proof_ready: "凭证已准备",
        proof_copied: "凭证已复制",
        proof_copy_failed: "复制失败",
        context_chips: "约束条件",
        context_glossary: "输入目标 · 获取3个方案 · 选择执行 · 获取凭证",
        recommended_solution: "推荐方案",
        recommended_subtitle: "图片 + 相关评论 + 推荐理由",
        near_heading: "附近",
        near_filters: "筛选",
        near_results: "结果",
        near_map: "地图预览",
        trips_heading: "订单与行程",
        me_preferences: "我的偏好",
        plus_heading: "Cross X Plus",
        plus_description: "7x24人工接管、更快响应、实时同传、稀缺资源代抢、部分费率优惠。",
        payment_limits_heading: "支付与限额",
        trust_summary_heading: "信任摘要（用户视角）",
        auth_heading: "授权域",
        operation_heading: "操作追踪链",
        privacy_heading: "隐私与数据",
        support_heading: "支持工单",
        human_assist_heading: "人工监督台",
        assist_open_support: "打开工单中心",
        assist_refresh_status: "刷新监督状态",
        advanced_heading: "高级（管理员）",
        save_preferences: "保存偏好",
        switch_mode: "切换模式",
        activate_plus: "开通 Plus",
        pause_plus: "暂停 Plus",
        save_payment_method: "保存支付方式",
        update_authorization: "更新授权",
        export_data: "导出我的数据",
        delete_data: "删除我的数据",
        provider_probe: "探测数据源",
        provider_probe_ready: "实时数据源正常",
        provider_probe_missing: "缺少环境变量",
        placeholder_dietary_pref: "清真 / 纯素 / 过敏...",
        placeholder_hotel: "常用地点：酒店",
        placeholder_office: "常用地点：办公室",
        placeholder_airport: "PVG / SHA",
        placeholder_replan_dietary: "例如：清真、纯素",
        step_tool: "工具",
        step_input: "输入",
        step_output: "输出",
        step_evidence: "证据",
        step_fallback: "兜底",
        step_failure_reason: "失败原因",
        step_current: "当前执行步骤",
        fallback_title: "兜底方案",
      },
    },
    EN: {
      terms: {
        task: "Task",
        plan: "Plan",
        lane: "Lane",
        proof: "Proof",
      },
      ui: {
        language_name: "English",
        tab_chat: "Chat",
        tab_near: "Near Me",
        tab_trips: "Trips",
        tab_me: "Me",
        tab_trust: "Trust",
        send: "Send",
        execute: "Confirm and Execute",
        emergency: "Emergency",
        input_placeholder: "Example: Find authentic local food nearby and complete queue, pay, and navigation.",
        one_sentence: "One sentence, one closed loop.",
        loading_plan: "Building your plan...",
        close: "Close",
        cancel: "Cancel",
        confirm: "Confirm",
        open_trust_advanced: "Open Trust Advanced",
        lane_tradeoffs: "Lane tradeoffs",
        lane_show_details: "Expand tradeoffs",
        lane_hide_details: "Collapse tradeoffs",
        run_lane: "Try this lane",
        proof_ready: "Proof is ready",
        proof_copied: "Proof copied",
        proof_copy_failed: "Copy failed",
        context_chips: "Context Chips",
        context_glossary: "Describe your goal · compare 3 options · execute one · receive proof",
        recommended_solution: "Recommended Solution",
        recommended_subtitle: "Images + related comments + recommendation reasons",
        near_heading: "Near Me",
        near_filters: "Filters",
        near_results: "Results",
        near_map: "Map Preview",
        trips_heading: "Trips & Orders",
        me_preferences: "My Preferences",
        plus_heading: "Cross X Plus",
        plus_description: "24/7 human fallback, faster response, real-time translation, scarce-resource concierge, and selected fee discounts.",
        payment_limits_heading: "Payment & Limits",
        trust_summary_heading: "Trust Summary (User View)",
        auth_heading: "Authorization Domain",
        operation_heading: "Operation Tracking Chain",
        privacy_heading: "Privacy & Data",
        support_heading: "Support Tickets",
        human_assist_heading: "Human Assist Desk",
        assist_open_support: "Open Support Desk",
        assist_refresh_status: "Refresh Assist Status",
        advanced_heading: "Advanced (Admin)",
        save_preferences: "Save Preferences",
        switch_mode: "Switch Mode",
        activate_plus: "Activate Plus",
        pause_plus: "Pause Plus",
        save_payment_method: "Save Payment Method",
        update_authorization: "Update Authorization",
        export_data: "Export My Data",
        delete_data: "Delete My Data",
        provider_probe: "Probe Providers",
        provider_probe_ready: "Live providers healthy",
        provider_probe_missing: "Missing environment variables",
        placeholder_dietary_pref: "halal / vegan / allergy...",
        placeholder_hotel: "Saved place: hotel",
        placeholder_office: "Saved place: office",
        placeholder_airport: "PVG / SHA",
        placeholder_replan_dietary: "e.g. halal, vegan",
        step_tool: "Tool",
        step_input: "Input",
        step_output: "Output",
        step_evidence: "Evidence",
        step_fallback: "Fallback",
        step_failure_reason: "Failure reason",
        step_current: "Current running step",
        fallback_title: "Fallback options",
      },
    },
    ID: {
      terms: {
        task: "Tugas",
        plan: "Rencana",
        lane: "Rute",
        proof: "Bukti",
      },
      ui: {
        language_name: "Bahasa",
        tab_chat: "Chat",
        tab_near: "Dekat",
        tab_trips: "Pesanan",
        tab_me: "Saya",
        tab_trust: "Kepercayaan",
        send: "Kirim",
        execute: "Konfirmasi & Eksekusi",
        emergency: "Darurat",
        input_placeholder: "Contoh: Cari makanan lokal terdekat lalu urus antre, bayar, dan navigasi.",
        one_sentence: "Satu kalimat, satu closed loop.",
      },
    },
    JA: {
      terms: {
        task: "タスク",
        plan: "プラン",
        lane: "ルート",
        proof: "証憑",
      },
      ui: {
        language_name: "日本語",
        tab_chat: "チャット",
        tab_near: "近く",
        tab_trips: "注文",
        tab_me: "マイ",
        tab_trust: "信頼",
        send: "送信",
        execute: "確認して実行",
        emergency: "緊急サポート",
        input_placeholder: "例: 近くのローカル店を探して、並び・支払い・ナビまで完了して。",
        one_sentence: "一言で、実行まで閉じる。",
        loading_plan: "プランを作成中...",
        close: "閉じる",
        cancel: "キャンセル",
        confirm: "確認",
        open_trust_advanced: "信頼の詳細設定を開く",
        lane_tradeoffs: "ルート比較",
        lane_show_details: "詳細を表示",
        lane_hide_details: "詳細を閉じる",
        run_lane: "このルートを実行",
        proof_ready: "証憑を用意しました",
        proof_copied: "証憑をコピーしました",
        proof_copy_failed: "コピーに失敗しました",
        context_chips: "条件チップ",
        context_glossary: "目的を入力 · 3案を比較 · 実行を選択 · 証憑を受取",
        recommended_solution: "おすすめプラン",
        recommended_subtitle: "画像 + 関連コメント + 推奨理由",
        near_heading: "近く",
        near_filters: "フィルター",
        near_results: "結果",
        near_map: "地図プレビュー",
        trips_heading: "注文と旅程",
        me_preferences: "マイ設定",
        plus_heading: "Cross X Plus",
        plus_description: "24時間有人対応、応答高速化、リアルタイム通訳、希少リソース代行、手数料優遇。",
        payment_limits_heading: "支払いと上限",
        trust_summary_heading: "信頼サマリー（ユーザー）",
        auth_heading: "委任設定",
        operation_heading: "操作追跡チェーン",
        privacy_heading: "プライバシーとデータ",
        support_heading: "サポートチケット",
        human_assist_heading: "有人サポートデスク",
        assist_open_support: "サポート窓口を開く",
        assist_refresh_status: "監督状態を更新",
        advanced_heading: "詳細設定（管理者）",
        save_preferences: "設定を保存",
        switch_mode: "モード切替",
        activate_plus: "Plus を有効化",
        pause_plus: "Plus を一時停止",
        save_payment_method: "支払い方法を保存",
        update_authorization: "委任設定を更新",
        export_data: "データをエクスポート",
        delete_data: "データを削除",
        provider_probe: "データソース診断",
        provider_probe_ready: "ライブ接続は正常です",
        provider_probe_missing: "環境変数が不足しています",
        placeholder_dietary_pref: "ハラル / ヴィーガン / アレルギー...",
        placeholder_hotel: "保存先: ホテル",
        placeholder_office: "保存先: オフィス",
        placeholder_airport: "PVG / SHA",
        placeholder_replan_dietary: "例: ハラル、ヴィーガン",
        step_tool: "ツール",
        step_input: "入力",
        step_output: "出力",
        step_evidence: "証跡",
        step_fallback: "フォールバック",
        step_failure_reason: "失敗理由",
        step_current: "現在実行中のステップ",
        fallback_title: "フォールバック",
      },
    },
    KO: {
      terms: {
        task: "작업",
        plan: "계획",
        lane: "경로",
        proof: "증빙",
      },
      ui: {
        language_name: "한국어",
        tab_chat: "채팅",
        tab_near: "근처",
        tab_trips: "주문",
        tab_me: "내 정보",
        tab_trust: "신뢰",
        send: "전송",
        execute: "확인 후 실행",
        emergency: "긴급 지원",
        input_placeholder: "예: 근처 로컬 맛집을 찾아서 대기/결제/길안내까지 완료해줘.",
        one_sentence: "한 문장으로, 실행까지 닫힌 루프.",
        loading_plan: "계획을 생성 중...",
        close: "닫기",
        cancel: "취소",
        confirm: "확인",
        open_trust_advanced: "신뢰 고급 설정 열기",
        lane_tradeoffs: "경로 비교",
        lane_show_details: "상세 보기",
        lane_hide_details: "상세 닫기",
        run_lane: "이 경로 실행",
        proof_ready: "증빙이 준비되었습니다",
        proof_copied: "증빙을 복사했습니다",
        proof_copy_failed: "복사 실패",
        context_chips: "조건 칩",
        context_glossary: "목표 입력 · 3개 옵션 비교 · 실행 선택 · 증빙 수령",
        recommended_solution: "추천 솔루션",
        recommended_subtitle: "이미지 + 관련 코멘트 + 추천 이유",
        near_heading: "근처",
        near_filters: "필터",
        near_results: "결과",
        near_map: "지도 미리보기",
        trips_heading: "주문 및 일정",
        me_preferences: "내 선호",
        plus_heading: "Cross X Plus",
        plus_description: "24시간 사람 상담, 더 빠른 응답, 실시간 통역, 희소 자원 대행, 일부 수수료 할인.",
        payment_limits_heading: "결제 및 한도",
        trust_summary_heading: "신뢰 요약 (사용자)",
        auth_heading: "위임 설정",
        operation_heading: "작업 추적 체인",
        privacy_heading: "개인정보 및 데이터",
        support_heading: "지원 티켓",
        human_assist_heading: "사람 지원 데스크",
        assist_open_support: "지원 데스크 열기",
        assist_refresh_status: "감독 상태 새로고침",
        advanced_heading: "고급 (관리자)",
        save_preferences: "선호 저장",
        switch_mode: "모드 전환",
        activate_plus: "Plus 활성화",
        pause_plus: "Plus 일시중지",
        save_payment_method: "결제수단 저장",
        update_authorization: "위임 설정 업데이트",
        export_data: "내 데이터 내보내기",
        delete_data: "내 데이터 삭제",
        provider_probe: "데이터 소스 점검",
        provider_probe_ready: "실시간 공급자 정상",
        provider_probe_missing: "환경 변수가 누락됨",
        placeholder_dietary_pref: "할랄 / 비건 / 알레르기...",
        placeholder_hotel: "저장 장소: 호텔",
        placeholder_office: "저장 장소: 사무실",
        placeholder_airport: "PVG / SHA",
        placeholder_replan_dietary: "예: 할랄, 비건",
        step_tool: "도구",
        step_input: "입력",
        step_output: "출력",
        step_evidence: "증빙",
        step_fallback: "대체 경로",
        step_failure_reason: "실패 사유",
        step_current: "현재 실행 단계",
        fallback_title: "대체 실행",
      },
    },
  };

  function pathGet(object, key) {
    if (!object || !key) return "";
    return String(key)
      .split(".")
      .reduce((memo, part) => (memo && memo[part] !== undefined ? memo[part] : ""), object);
  }

  function fill(str, vars) {
    return String(str || "").replace(/\{(\w+)\}/g, (_, k) => (vars && vars[k] !== undefined ? String(vars[k]) : ""));
  }

  function normalizeLanguage(language) {
    if (!language) return "ZH";
    const upper = String(language).toUpperCase();
    if (upper.startsWith("ZH")) return "ZH";
    if (upper.startsWith("EN")) return "EN";
    if (upper.startsWith("ID") || upper.startsWith("IN")) return "ID";
    if (upper.startsWith("JA") || upper.startsWith("JP")) return "JA";
    if (upper.startsWith("KO")) return "KO";
    return dictionary[upper] ? upper : "EN";
  }

  function t(language, key, vars) {
    const lang = normalizeLanguage(language);
    const fallback = "EN";
    const value = pathGet(dictionary[lang], key) || pathGet(dictionary[fallback], key) || key;
    return fill(value, vars);
  }

  function term(language, key) {
    return t(language, `terms.${key}`);
  }

  function languageName(language) {
    return t(language, "ui.language_name");
  }

  global.CrossXI18n = {
    t,
    term,
    normalizeLanguage,
    languageName,
    supported: Object.keys(dictionary),
  };
})(window);
